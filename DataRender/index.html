<!DOCTYPE html>
<html>

<head>
    <title>Data Rendering</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

    <style>
        td {
            margin: auto;
            text-align: center;
        }

        .container {
            padding: 2rem 0rem;
        }

        img {
            width: 100px;
            height: 100px;
        }
    </style>
</head>

<body>
    <div id="loadingOverlay" class="d-flex justify-content-center align-items-center"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.8); z-index: 9999; display: none;">
        <div class="spinner-border text-primary" role="status" style="width: 5rem; height: 5rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    <div id="main" class="container">

        <div class="container my-4">
            <h4>Filter Products</h4>
            <div class="row g-3 align-items-center">
                <div class="col-md-4">
                    <label for="descFilter" class="form-label">Title</label>
                    <input type="text" id="titleFilter" class="form-control" placeholder="Search Title">
                </div>

                <!-- <div class="col-md-4">
                    <label class="form-label">Price Range: <span id="priceValue">0 - 1000</span></label>
                    <div class="range-slider">
                        <input type="range" min="0" max="1000" value="0" id="minRange" class="range-input">
                        <input type="range" min="0" max="1000" value="1000" id="maxRange" class="range-input">
                    </div>
                </div> -->


                <div class="col-md-4">
                    <label for="categoryFilter" class="form-label">Category</label>
                    <select id="categoryFilter" class="form-select">
                        <option value="">All Categories</option>
                        <option value="electronics">Electronics</option>
                        <option value="jewelery">Jewelery</option>
                        <option value="men's clothing">Men's Clothing</option>
                        <option value="women's clothing">Women's Clothing</option>
                    </select>
                </div>
            </div>

            <div class="mt-3">
                <button class="btn btn-primary" id="applyFilter">Apply Filter</button>
                <button class="btn btn-secondary" id="resetFilter">Reset Filter</button>
            </div>
        </div>

        <div class="container">

            <div class="container text-center">
                <div class="row">
                    <div class="col">
                    </div>
                    <div class="col">
                    </div>
                    <div class="col">
                    </div>
                </div>
            </div>

        </div>
        <div class="container">
            <button onclick="createPage()" class="btn btn-warning" type="button">Create New Product</button>
        </div>

        <table class="table text-center align-items-center">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Image</th>
                    <th scope="col">Title</th>
                    <th scope="col">Action</th>

                </tr>
            </thead>
            <tbody id="data">

            </tbody>

        </table>

        <nav aria-label="...">
            <ul class="pagination justify-content-center">
                <li id="prev" class="page-item" style="margin-right: 40px;">
                    <a class="page-link" href="#" tabindex="-1">Previous</a>
                </li>

                <li id="next" class="page-item mx-10">
                    <a class="page-link" href="#">Next</a>
                </li>
            </ul>
        </nav>

    </div>

    <script>
        let products = [];
        let currentPage = 1;
        const itemsPerPage = 4;
        let totalPage = 1;

        let paginationProducts;
        let spinner = document.getElementById("loadingOverlay");
        let dataDiv = document.getElementById("main");

        allProducts("https://fakestoreapi.com/products");
        async function allProducts(url) {



            spinner.style.visibility = 'visible';
            dataDiv.style.visibility = 'hidden';
            const response = await fetch(url);
            try {
                if (!response) {
                    throw new Error('Unable to fetch data');
                }
                products = await response.json();
                loadProducts(products);

            } catch (error) {
                console.error(error);
            }
        }

        function loadProducts() {
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            paginationProducts = products.slice(start, end);
            console.log(products);
            const tabledata = document.getElementById("data");
            totalPage = Math.ceil(products.length / itemsPerPage);

            console.log(totalPage);
            tabledata.innerHTML = ""
            paginationProducts.forEach(product => {

                const row = document.createElement('tr');

                const img = document.createElement('td');
                const src = document.createElement('img');
                src.setAttribute('src', product.image);
                img.appendChild(src);
                row.appendChild(img);

                const title = document.createElement('td');
                title.textContent = product.title;
                row.appendChild(title);

                const action = document.createElement('td');

                const view = document.createElement('button');

                view.type = 'button';
                view.className = 'btn btn-primary btn-medium px-5 mt-4';
                view.textContent = 'View';
                view.dataset.id = product.id;

                view.addEventListener('click', () => {

                    localStorage.setItem("pid", product.id);
                    window.location.href = "view.html";
                })
                action.appendChild(view);


                const edit = document.createElement('button');

                edit.type = 'button';
                edit.className = 'btn btn-success btn-medium px-5 ms-md-3 mt-4';
                edit.textContent = 'Edit';
                edit.addEventListener('click', () => {

                    localStorage.setItem("pid", product.id);
                    window.location.href = "edit.html";
                });

                action.appendChild(edit);

                const deleteProduct = document.createElement('button');

                deleteProduct.type = 'button';
                deleteProduct.className = 'btn btn-danger btn-medium px-2 ms-md-3 mt-4';
                deleteProduct.textContent = 'Delete';
                deleteProduct.dataset.id = product.id;

                deleteProduct.addEventListener('click', async () => {
                    await deleteProductt(product.id, row);
                });
                action.append(deleteProduct);
                row.appendChild(action);
                tabledata.appendChild(row);
                dataDiv.style.visibility = 'visible';
                spinner.style.visibility = 'hidden';

            });
        }



        document.getElementById("applyFilter").addEventListener('click', function () {

            let input = $("#titleFilter").val();
            $("#data tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(input) > -1)
            });

        });



        document.getElementById("next").addEventListener('click', () => {
            if (currentPage == totalPage) {
                this.disabled = true;
                return;
            }

            currentPage++;
            loadProducts();
        });
        document.getElementById("prev").addEventListener('click', () => {
            if (currentPage == 1) {
                this.disabled = true;
                return;
            }
            currentPage--;
            allProducts("https://fakestoreapi.com/products");
        });




        async function deleteProductt(id, row) {
            if (!confirm('Are you sure you want to delete this product?')) return;

            try {
                const response = await fetch(`https://fakestoreapi.com/products/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Failed to delete product');

                const result = await response.json();

                row.remove();

            } catch (error) {
                console.error(error);
                alert('Error deleting product.');
            }
        }



        function createPage() {
            window.location.href = 'create.html';
        }


    </script>



    </script>
</body>

</html>