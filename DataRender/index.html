<!DOCTYPE html>
<html>

<head>
    <title>Data Rendering</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

    <style>
        td {
            margin: auto;
            text-align: center;
        }

        .container {
            padding: 2rem 0rem;
        }

        img {
            width: 100px;
            height: 100px;
        }
    </style>
</head>

<body>
    <div id="loadingOverlay" class="d-flex justify-content-center align-items-center"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.8); z-index: 9999; display: none;">
        <div class="spinner-border text-primary" role="status" style="width: 5rem; height: 5rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    <div id="main" class="container">

        <table class="table">
            <thead class="thead-dark">
                <tr style="text-align: center;">
                    <th scope="col">Image</th>
                    <th scope="col">Title</th>
                    <th scope="col">Action</th>

                </tr>
            </thead>
            <tbody id="data">

            </tbody>
            <script>
                let data;
                async function allProducts(url) {
                    let spinner = document.getElementById("loadingOverlay");
                    let dataDiv = document.getElementById("main");
                    spinner.style.visibility = 'visible';
                    dataDiv.style.visibility = 'hidden';

                    const response = await fetch(url);
                    try {
                        if (!response) {
                            throw new Error('Unable to fetch data');
                        }
                        data = await response.json();
                        console.log(data);
                        const tabledata = document.getElementById("data");
                        data.forEach(product => {

                            const row = document.createElement('tr');

                            // const price = document.createElement('td');
                            // price.textContent = Math.round(product.price);
                            // row.appendChild(price);

                            // const newPrice = document.createElement('td');
                            // newPrice.textContent = Math.round(product.price - product.price * 10 / 100);
                            // row.appendChild(newPrice);

                            // const category = document.createElement('td');
                            // category.textContent = product.category;
                            // row.appendChild(category);

                            // const description = document.createElement('td');
                            // description.textContent = product.description;
                            // row.appendChild(description);


                            const img = document.createElement('td');
                            const src = document.createElement('img');
                            src.setAttribute('src', product.image);
                            img.appendChild(src);
                            row.appendChild(img);

                            const title = document.createElement('td');
                            title.textContent = product.title;
                            row.appendChild(title);

                            const action = document.createElement('td');

                            const view = document.createElement('button');

                            view.type = 'button';
                            view.className = 'btn btn-primary btn-midum px-5 mt-4';
                            view.textContent = 'View';
                            view.dataset.id = product.id;

                            view.addEventListener('click', () => {

                                localStorage.setItem("pid", product.id);
                                window.location.href = "view.html";
                            })
                            action.appendChild(view);


                            const edit = document.createElement('button');

                            edit.type = 'button';
                            edit.className = 'btn btn-success btn-medium px-5 ms-md-3 mt-4';
                            edit.textContent = 'Edit';
                            action.appendChild(edit);

                            const deleteProduct = document.createElement('button');

                            deleteProduct.type = 'button';
                            deleteProduct.className = 'btn btn-danger btn-medium px-2 ms-md-3 mt-4';
                            deleteProduct.textContent = 'Delete';
                            deleteProduct.dataset.id = product.id;

                            deleteProduct.addEventListener('click', async () => {
                                await deleteProductt(product.id, row);
                            });
                            action.append(deleteProduct);
                            row.appendChild(action);
                            tabledata.appendChild(row);


                        });
                    } catch (error) {
                        console.error(error);
                    } finally {
                        dataDiv.style.visibility = 'visible';
                        spinner.style.visibility = 'hidden';
                    }
                }

                allProducts('https://fakestoreapi.com/products');

                async function deleteProductt(id, row) {
                    if (!confirm('Are you sure you want to delete this product?')) return;

                    try {
                        const response = await fetch(`https://fakestoreapi.com/products/${id}`, {
                            method: 'DELETE'
                        });

                        if (!response.ok) throw new Error('Failed to delete product');

                        const result = await response.json();

                        row.remove();

                    } catch (error) {
                        console.error(error);
                        alert('Error deleting product.');
                    }
                }

            </script>

        </table>

    </div>
</body>

</html>